<template>
<div class="page" data-name="settings">
  <div class="navbar">
    <div class="navbar-bg"></div>
    <div class="navbar-inner sliding">
      <div class="left">
        <a href="#" class="link back">
          <i class="icon icon-back"></i>
          <span class="if-not-md">Back</span>
        </a>
      </div>
      <div class="title">Settings</div>
    </div>
  </div>
  <div class="page-content">
    <div class="block-title">个人资料设置</div>

<!-- Form 的URL Get参数集合里需要传入user_id=[Edit:ID]，从而保证CCS框架的代码可以正常做Update -->
<form action="https://adverse.kideduc.com/api/EditEmployee.php?emp_id=${users.value.length > 0 ? users.value[0].id : -1}&ccsForm=employees%3AEdit" method="POST" class="list form-ajax-submit" id="my-form">
<!-- Laravel 的请求处理系统要求所有非 GET 和 POST 的请求全部通过 POST 请求来执行，再将真正的方法使用 _method 表单字段携带给后端。 -->

    ${users.value.length > 0 ? $h`
    <div class="list no-hairlines-md">
      ${users.value.map((user) => $h`
      <ul>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">姓名</div>
              <div class="item-input-wrap">
                <input type="text" name="emp_name" placeholder="Your name"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">性别</div>
              <div class="item-input-wrap">
                <select name="gender_id">
                  <option value="1">男性</option>
                  <option value="2">女性</option>
                  <option value="9">未知</option>
                </select>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">年龄</div>
              <div class="item-input-wrap">
                <select name="age_id">
                  <option value="1">婴儿(1岁以下)</option>
                  <option value="2">幼儿(1-3岁)</option>
                  <option value="3">学龄阶段(4-6岁)</option>
                  <option value="4">学龄期(7-12岁)</option>
                  <option value="5">青少年(13-18岁)</option>
                  <option value="6">成年(19-64岁)</option>
                  <option value="7">老年(65岁以上)</option>
                  <option value="8">不详</option>
                </select>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">职务</div>
              <div class="item-input-wrap">
                <input type="text" name="title" placeholder="Your title"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">手机号</div>
              <div class="item-input-wrap">
                <input type="tel" name="fax" placeholder="Mobile"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">教育程度</div>
              <div class="item-input-wrap">
                <select name="education_id">
                  <option value="1">High School</option>
                  <option value="2">College</option>
                  <option value="3">Graduate School</option>
                  <option value="4">Other</option>
                </select>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">电子邮箱</div>
              <div class="item-input-wrap">
                <input type="email" name="email" placeholder="E-mail"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">Phone Home</div>
              <div class="item-input-wrap">
                <input type="tel" name="phone_home" placeholder="Phone Home"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">Phone Work</div>
              <div class="item-input-wrap">
                <input type="tel" name="phone_work" placeholder="Phone Work"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">Phone Cell</div>
              <div class="item-input-wrap">
                <input type="tel" name="phone_cell" placeholder="Phone Cell"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">所在城市</div>
              <div class="item-input-wrap">
                <input type="text" name="city" placeholder="City"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">邮编</div>
              <div class="item-input-wrap">
                <input type="text" name="zip" placeholder="Zip Code"/>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">地址处所</div>
              <div class="item-input-wrap">
                <input type="text" name="address" placeholder="Address"/>
              </div>
            </div>
          </div>
        </li>
        <li class="align-top">
          <div class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">个性标签</div>
              <div class="item-input-wrap">
                <textarea placeholder="Bio" name="notes" class="resizable"></textarea>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content">
            <div class="item-inner">
              <div class="item-title">His数据同步</div>
              <div class="item-after">
                <label class="toggle toggle-init">
                  <input type="checkbox" name="ilot" value="yes" />
                  <i class="toggle-icon"></i>
                </label>
              </div>
            </div>
          </div>
        </li>
      </ul>
      `)}
    </div>
    <!-- Buttons Submit Starting -->
    <!-- <div class="block-title">Buttons</div>
    <div class="block block-strong">
      <p class="row">
        <a href="#" class="col button button-raised color-green">取消</a>
        <a href="#" class="col button button-raised button-fill color-red">保存</a>
      </p>
      <p class="row">
      </p>
    </div> -->
    <div class="block block-strong">
      <p class="row">
        <button class="col button button-fill color-red" type="submit">Save Data</button>
      </p>
      <p class="row"></p>
    </div>
    <!-- Buttons Submit Ending -->
    ` : $h`
    <div class="block block-strong">
      <p class="row">
        <!-- <div class="block">请首先登录系统再修改个人资料</div>
        <button class="col button button-fill color-red" onclick="submit">我要登录</button> -->
        请首先登录系统再修改个人资料
      </p>
      <p class="row">
        <a class="button button-fill color-red fill-form-login"  href="#">我要登录</a>
      </p>
    </div>
    `}
</form>

    <!-- Buttons Fill Form Data Here style="display:none;" style="height:0px" -->
    <div class="block block-strong row" style="display:none;">
      <div class="col"><a class="button button-fill fill-form-from-data-a"  href="#">Fill Eva</a></div>
      <div class="col"><a class="button button-fill fill-form-from-data-c"  href="#">Fill Store</a></div>
      <div class="col"><a class="button button-fill fill-form-from-data-b"  href="#">Fill YangY</a></div>
      <div class="col"><a class="button button-fill fill-form-from-data-k"  href="#">testing</a></div>
    </div>
    <!-- END OF Fill Form Data Buttons  -->

  </div>
</div>
</template>
<script>
export default (props, { $, $on, $f7, $store }) => {
    //----------------------------------------------------
    const loading = $store.getters.loading;
    const users   = $store.getters.users;
    //----------------------------------------------------
    // Component Data

    // Component Methods

    // Lifecycle

    // Page Events
    $on('pageInit', () => {
        // ------------------------------    Request Data from AJAX   -----------------------------------------
        console.log("profile.f7 pageInit! " + users.value.length);

        // -------------------------------------    DOM Events  -----------------------------------------
        $('.fill-form-from-data-a').on('click', function(){
          var formData = {
            'city': "上海浦东",
            'title': "白领丽人",
            'gender_id': 2,
            'age_id': 3,
            'email': "eva@kideduc.com",
            'education_id': 1,
            'notes': "停车坐爱枫林晚，霜叶红于二月花",
          }
          $f7.form.fillFromData('#my-form', formData);
        });
        $('.fill-form-from-data-b').on('click', function(){
          var formData = {
            'city': "北京三里屯",
            'title': "美貌少妇",
            'gender_id': 2,
            'age_id': 4,
            'email': "yangy@kideduc.com",
            'education_id': 4,
            'notes': "花径不曾缘客扫，蓬门今始为君开",
          }
          $f7.form.fillFromData('#my-form', formData);
        });
        $('.fill-form-from-data-c').on('click', function(){
          console.log("xxxxx YangY OOXX! " + users.value.length + '|' + users.value[0].first_name);
          var formData = {
              'emp_name': users.value[0].first_name,
                'gender_id':users.value[0].gender,
                'age_id':   users.value[0].age,
                'title':    users.value[0].last_name,
                'fax':     users.value[0].fax,
                'education_id': users.value[0].education,
                'email':    users.value[0].email,
              'phone_home': users.value[0].phone_home,
              'phone_work': users.value[0].phone_work,
              'phone_cell': users.value[0].phone_cell,
                'city':     users.value[0].city,
                'zip': users.value[0].zip,
                'address': users.value[0].address,
                'notes':    users.value[0].notes,
                'ilot':     ['yes'],
          }
          $f7.form.fillFromData('#my-form', formData);
        });

        $('.fill-form-login').on('click', function(){
          
          $f7.loginScreen.open('.login-screen', true);
        });

        $('.fill-form-from-data-k').on('click', function(){
          console.log("Form Action URL:! " + $f7.$('form#my-form').attr('action'));
        }); 

        // Framework7::Ajax Form Submit Events
        // Sometimes we need to get actual XHR repsonse from the file/url where we send form data with Ajax. We can use special events for that
        $('form.form-ajax-submit').on('formajax:success', function (e) {
          var xhr = e.detail.xhr; // actual XHR object

          var data = e.detail.data; // Ajax response from action file
          // do something with response data
          // -------------------------------------------------------DEBUG---------
          console.log("---Ajax Feedback : Saving Success!!");
          console.log("xhr status==|" + xhr.status + "|");              // 200
//        console.log("xhr responseText==|" + xhr.responseText + "|");  // response Text
          console.log("data post::phone_home==|" + data.phone_home + "|");    // From Data in POST Method , before Submit
          // -------------------------------------------------------BEGIN---------
          // Actual Logic of Our Business 
          if (xhr.status == 200) {
              var newUsers = JSON.parse(xhr.responseText)['users'];
              console.log("tesing xhr.responseText => user's first_name = "+newUsers[0]["first_name"]);
              $store.state.users = newUsers;
              console.log("---Re-Write into Session Success!");
          }else {
              console.log("Error! Unknown status code [" + xhr.status + "]");
          }
          // -------------------------------------------------------END-----------
        });

        // -------------------------------------    App Events  -----------------------------------------
        // ==================================================================================
        // Important !!! Important !!! Important !!! Important !!! Important !!! Important !!! 2021.07.05 15:49 Tony: Coding many many times!
        console.log("Trigger Button CLick|Automatic Loading!!");
        $('.fill-form-from-data-c').click();
        // ==================================================================================

    });

    $on('pageBeforeRemove', () => {
        console.log('pageBeforeRemove');
    });
    //----------------------------------------------------
    return $render;
};
</script>